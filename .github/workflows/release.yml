# .github/workflows/release.yml
name: Build and Release (Windows)

# Triggers the workflow when a new tag is pushed (e.g., git push --tags)
on: 
  push:
    tags:
      - 'v*' # Run only when a tag starting with 'v' is pushed (e.g., v0.0.1, v0.0.2)

jobs:
  release:
    runs-on: windows-latest 

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # Fetch all history and tags for electron-builder to work properly
          fetch-depth: 0 
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Dependencies
        run: npm install

      # Build and Publish Command
      - name: Build/Release (Windows)
        # The '-p always' flag tells electron-builder to publish immediately 
        # using the settings defined in package.json (GitHub).
        run: npm run electron:make -- -p always
        env:
          # This token is automatically generated by GitHub and gives permission 
          # to create the Release.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
